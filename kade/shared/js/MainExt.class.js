var MainExt=function(){var a=null;var k=60;var b=false;var c="";var i=60;var e=new Array();var h=false;var j=function(){$("#button_save").button().click(function(n){n.preventDefault();$("#banner_form").submit()});$("#banner_id").change(function(n){n.preventDefault();d=new Date();$("#banner_img").attr("src","../shared/images/banner_slider"+$("#banner_id").val()+".jpg")});c=$("#banner_form").serialize();$("#banner_form").submit(function(){var n=$(this).serialize();if(h&&c==n){System.showMessageDialog("Voc� n�o alterou nenhuma informa��o para salvar!");return false}c=n;if(b){return false}b=true;$("#dialog-working").dialog("open");intTimeOut=window.setTimeout(function(){onTimeoutSaving()},i*1000);return true});$("#banner_iframe").load(function(){if(b){b=false;$("#dialog-working").dialog("close");window.clearInterval(intTimeOut);intTimeOut=null;var t="";try{var s=$(this).contents().text();var v=$.parseJSON(s);System.setImgMessage(v.result);t=v.message;var q=new Array();for(var u in e){var n=e[u];$(n).css("background","#FFFFFF")}e=new Array();if(v.result=="error"){if(v.validationException.length>0){t+="<br/></br>";for(var u in v.validationException){var p=v.validationException[u];var o=(p.id!="");p.id="#"+(p.id.replace(/\./g,"\\."));if(o){$(p.id).css("background","#FFC1C1")}e.push(p.id);q.push(p.message)}t+=q.join("<br/>")}}else{$("#banner_form .input_clear").val("");d=new Date();$("#banner_img").attr("src",$("#banner_img").attr("src")+"?a="+d.getMilliseconds())}}catch(r){System.setImgMessage("error");t="Erro ao realizar registro<br/><br/>";t+="O sistema esta indispon�vel no momento, aguarde e tente novamente mais tarde. <br/><br/>";t+="Detalhes t�cnicos: "+r.message}$("#dialog-result\\.messageText").html(t);$("#dialog-result").dialog("open")}});$("#dialog-result").dialog({autoOpen:false,closeOnEscape:false,width:640,height:240,modal:true,open:function(n,o){$(this).parent().children().children(".ui-dialog-titlebar-close").hide()},buttons:{OK:function(){$(this).dialog("close")}}});$("#dialog-working").dialog({width:420,height:220,modal:true,autoOpen:false,draggable:false,resizable:false,closeOnEscape:false,open:function(n,o){$(this).parent().children().children(".ui-dialog-titlebar-close").hide()}})};var g=function(){box=$("#box_loading");if(box.length==0){wait_text="Aguarde, carregando...";pag=$("body");box=$("<div/>").attr("id","box_loading");elem2=$("<div/>").css({fontWeight:"bold"});elem3=$("<center/>");elem4=$("<img/>").attr("src",System.CONTEXT+"shared/images/dialog-working.gif").css({width:"300px"});elem3.append(elem4);elem2.html(wait_text);box.append(elem2);box.append(elem3);pag.append(box)}box.toggle(true)};var m=function(){box=$("#box_loading");if(box.length!=0){box.toggle(false)}};var l=function(){var o=$("#maps_state").val();var n=System.CONTEXT+"MapsExtCtrl.ctrlExt/searchMaps";o.replace(/^\s+|\s+$/g,"");if(o!=""){n=System.CONTEXT+"MapsExtCtrl.ctrlExt/searchMapsByUf"}$.ajax({type:"POST",dataType:"html",url:n,data:({maps_state:o,is_ajax:true}),beforeSend:function(){g();window.clearInterval(a);a=null},error:function(r,p,q){m();System.defaultErrorHandlerJQueryAjax(r,p,q)},complete:function(){m()},success:function(p){if(p!=""){$("div.container").html(p)}}});a=window.setInterval(f,1000);k=60};var f=function(){if(k==0){l()}$("#crono").html(k);k=k-1};this.initQuery=function(){var q="Carregando ...";var s="Sem mapa!";var t=6;var u="#map-visible-list";var o="#addresses";var v="search.php";var w="region";var n="Search";$(".pix_diapo").diapo({fx:"blindCurtainTopLeft",time:"5000",thumbs:"false",gridDifference:"10"});$(document).on("click","a.a_city_uf_maps",function(z){z.preventDefault();$("#vehicle_region").val($(this).attr("uf"));$("#vehicle_city").val($(this).attr("city"));$("#form_maps").submit()});a=setInterval(f,1000);$.multipleClickAction=function(A){var z=[];$("#brasil").find(".active-region").each(function(){var C=$(this).children("a").attr("href");var B=C.slice(1);z.push(B)});$("#search-link").attr("href",v+"?"+w+"="+z.join("|"))};$.defaultClickAction=function(A){var z=$(A).children("a").attr("href");$(o).find("li").hide();$(z+","+z+" li").show();var B=z.substring(1,3);$("#maps_state").val(B);l()};$.doubleClickedRegion=function(z){$(z).removeClass("active-region");$(o).find("li").hide();$("#maps_state").val("");l()};$("#map-br").prepend('<span id="loader">'+q+"</span>").addClass("script");$("#brasil").find("a").hide();$(o).find("li").hide();if($("#map-br").hasClass("multiple-click")){if(v==""){var v="search.php"}if(w==""){var w="region"}if(n==""){var n="Search"}$('<a href="'+v+'" id="search-link">'+n+"</a>").insertAfter("#brasil")}if($("#map-br").hasClass("visible-list")){$("#map-br").after('<div id="'+u.slice(1)+'"><ul></ul></div>')}var x=$("#brasil").css("background-image").replace(/^url\("?([^\"\))]+)"?\)$/i,"$1");var p=new Image();$(p).load(function(){var z=[];$("#loader").fadeOut();$("#brasil").find("li").each(function(H){var I=$(this).attr("id");var C=$(this).children("a").attr("href");var A=null;var G=0;switch(I){case"br8":case"br19":case"br26":G=9;break;case"br4":case"br13":case"br14":G=34;break;case"br5":G=28;break;case"br7":G=2;break;case"br10":case"br12":case"br18":case"br21":G=19;break;case"br9":case"br11":case"br25":case"br27":G=23;break;default:G=14}var J=$(this).children("a").outerWidth()/-2;var E=$(this).children("a").outerHeight()*-1-t;if($("#map-br").hasClass("no-tooltip")){var E=0}$(this).prepend('<span class="map" />').append('<span class="bg" />').attr("tabindex",H+1);for(var F=1;F<G;F++){$(this).find(".map").append('<span class="s'+F+'" />')}$(this).children("a").css({"margin-left":J,"margin-top":E});if($("#map-br").hasClass("visible-list")){var D=$(this).children("a").attr("href");var B=$(this).children("a").text();$(u+" ul").append('<li class="'+I+'"><a href="'+D+'">'+B+"</a></li>")}if($(this).children("a").hasClass("active-region")||C==window.location.hash&&C!=""){$(this).addClass("active-region focus");$(o).find("li").hide();$(C+","+C+" li").show();$("."+$(this).attr("id")).children("a").addClass("active-region");$("#search-link").attr("href",v+"?"+w+"="+C.slice(1))}}).hover(function(){$.MapHoveredRegion($(this))},function(){$.MapUnHoveredRegion($(this))}).focus(function(){$.MapHoveredRegion($(this))}).blur(function(){$.MapUnHoveredRegion($(this))}).keypress(function(A){code=(A.keyCode?A.keyCode:A.which);if(code==13){$.MapClickedRegion($(this))}}).click(function(A){$.MapClickedRegion($(this))});if($("#map-br").hasClass("visible-list")){$(u).find("a").each(function(){var A="#"+$(this).parent().attr("class");$(this).hover(function(){$.MapHoveredRegion(A)},function(){$.MapUnHoveredRegion(A)}).focus(function(){$.MapHoveredRegion(A)}).blur(function(){$.MapUnHoveredRegion(A)}).keypress(function(B){code=(B.keyCode?B.keyCode:B.which);if(code==13){$.MapClickedRegion(A)}}).click(function(B){$.MapClickedRegion(A)})})}}).error(function(){$("#loader").text(s);$("#brasil").find("span").hide();$("#map-br,#brasil").css({height:"auto",left:"0",margin:"0 auto"})}).attr("src",x);$.MapClickedRegion=function(B){var z="."+$(B).attr("id");var A=$(B).children("a").attr("href");if(typeof A!="undefined"){if($("#map-br").hasClass("multiple-click")){if($(B).hasClass("active-region")){$(B).removeClass("active-region");$(z).children("a").removeClass("active-region")}else{if(A.length>=2){$(B).addClass("active-region");$(z).children("a").addClass("active-region")}}$.multipleClickAction(B)}else{if($(B).hasClass("active-region")){$.doubleClickedRegion(B);$(z).children("a").removeClass("active-region");$(B).attr("href","")}else{$("#brasil,"+u).find(".active-region").removeClass("active-region");$("#brasil").find(".focus").removeClass("focus");if($(B).hasClass("active-region")){$(B).removeClass("active-region focus");$(z).children("a").removeClass("active-region")}else{$(B).addClass("active-region focus").children("a").show();$(z).children("a").addClass("active-region")}$.defaultClickAction(B);$(B).children("a").show()}}}};$.MapHoveredRegion=function(A){var z=$(A).children("a").attr("href");if(typeof z!="undefined"&&z!=""){$("#brasil").find(".active-region").children("a").hide();$(A).children("a").show();$(A).addClass("focus");$("."+$(A).attr("id")).children("a").addClass("focus")}else{$(A).hide()}};$.MapUnHoveredRegion=function(z){$(z).children("a").hide();if($(z).hasClass("active-region")==false){$(z).removeClass("focus")}$("."+$(z).attr("id")).children("a").removeClass("focus")};var y=$("#loader").outerWidth()/-2;var r=$("#loader").outerHeight()/-2;$("#loader").css({"margin-left":y,"margin-top":r})};this.initLoadBanner=function(){j()}};MainExt.instance=null;MainExt.getInstance=function(){if(MainExt.intance==null){MainExt.instance=new MainExt()}return MainExt.instance};